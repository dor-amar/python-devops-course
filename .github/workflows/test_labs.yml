name: Test Python Labs

on:
  push:
    branches:
      - 'main'
      - 'lab-*'  # Only run on student lab branches

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest
    
    - name: Run tests
      run: |
        # Get the modified lab directory from changed files
        MODIFIED_LAB=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '^labs/lab_' | cut -d'/' -f1-2 | head -n1)
        
        if [ -n "$MODIFIED_LAB" ]; then
          echo "Running tests for $MODIFIED_LAB..."
          cd $MODIFIED_LAB
          python -m pytest tests/ -v
          cd ../..
        else
          echo "No lab files were modified"
        fi 